++ dirname ./dsa_config_test_runner.sh
+ . ./common
++ export SIZE_1=1
++ SIZE_1=1
++ export SIZE_512=512
++ SIZE_512=512
++ export SIZE_1K=1024
++ SIZE_1K=1024
++ export SIZE_4K=4096
++ SIZE_4K=4096
++ export SIZE_64K=65536
++ SIZE_64K=65536
++ export SIZE_1M=1048576
++ SIZE_1M=1048576
++ export SIZE_2M=2097152
++ SIZE_2M=2097152
++ export EXIT_FAILURE=1
++ EXIT_FAILURE=1
++ export EXIT_SKIP=77
++ EXIT_SKIP=77
++ TESTDIR=/usr/libexec/accel-config/test
++ BINDIR=/usr/bin
++ '[' -f ../accfg/accel-config ']'
++ '[' -x ../accfg/accel-config ']'
++ export ACCFG=../accfg/accel-config
++ ACCFG=../accfg/accel-config
++ '[' -f ./dsa_test ']'
++ '[' -x ./dsa_test ']'
++ export DSATEST=./dsa_test
++ DSATEST=./dsa_test
++ '[' -f ./iaa_test ']'
++ '[' -x ./iaa_test ']'
++ export IAATEST=./iaa_test
++ IAATEST=./iaa_test
++ '[' -f ./configs/2g2q_user_1.conf ']'
++ export CONFIG1=./configs/2g2q_user_1.conf
++ CONFIG1=./configs/2g2q_user_1.conf
++ '[' -f ./configs/2g2q_user_2.conf ']'
++ export CONFIG2=./configs/2g2q_user_2.conf
++ CONFIG2=./configs/2g2q_user_2.conf
+ DSA=dsa0
+ WQ0=wq0.0
+ GRP0=group0.0
+ ENG0=engine0.0
+ IDXD_DEVICE_PATH=/sys/bus/dsa/devices
+ '[' '!' -f ./dsa_test ']'
+ check_min_kver 5.6
+ local ver=5.6
++ uname -r
+ : 6.1.70
+ '[' -n 5.6 ']'
++ echo -e '5.6\n6.1.70'
++ sort -V
++ head -1
+ [[ 5.6 == \5\.\6 ]]
+ '[' '!' -f /sys/bus/dsa/devices/dsa0/pasid_enabled ']'
++ cat /sys/bus/dsa/devices/dsa0/pasid_enabled
+ pasid_en=1
+ '[' 1 -ne 1 ']'
++ cat /sys/bus/dsa/devices/dsa0/version
+ IDXD_VERSION=0x100
+ _cleanup
+ lsmod
+ grep -wq idxd_vdev
+ lsmod
+ grep -wq idxd_uacce
+ lsmod
+ grep -wq iaa_crypto
+ lsmod
+ grep -wq iax_crypto
+ lsmod
+ grep -wq idxd
+ rmmod idxd
+ lsmod
+ grep -wq vfio_pci
+ sleep 1
+ modprobe idxd
+ sleep 1
+ modprobe vfio_pci
+ group_config_test
+ local read_ret
+ '[' -f /sys/bus/dsa/devices/dsa0/group0.0/read_buffers_allowed ']'
+ ../accfg/accel-config config-group dsa0/group0.0 -r 37
++ cat /sys/bus/dsa/devices/dsa0/group0.0/read_buffers_reserved
+ read_ret=37
+ '[' 37 -ne 37 ']'
+ ../accfg/accel-config config-group dsa0/group0.0 --read-buffers-reserved 0
+ ../accfg/accel-config config-group dsa0/group0.0 -t 28
++ cat /sys/bus/dsa/devices/dsa0/group0.0/read_buffers_allowed
+ read_ret=28
+ '[' 28 -ne 28 ']'
+ ../accfg/accel-config config-group dsa0/group0.0 --read-buffers-allowed 0
+ ../accfg/accel-config config-device -l 11 dsa0
+ ../accfg/accel-config config-group dsa0/group0.0 -l 1
++ cat /sys/bus/dsa/devices/dsa0/group0.0/use_read_buffer_limit
+ read_ret=1
+ '[' 1 -ne 1 ']'
+ ../accfg/accel-config config-group dsa0/group0.0 --use-read-buffer-limit 0
+ ../accfg/accel-config config-device -l 0 dsa0
+ '[' 0x100 '!=' 0x100 ']'
+ engine_config_test
+ local read_ret
+ ../accfg/accel-config config-engine dsa0/engine0.0 -g 3
++ cat /sys/bus/dsa/devices/dsa0/engine0.0/group_id
+ read_ret=3
+ '[' 3 -ne 3 ']'
+ ../accfg/accel-config config-engine dsa0/engine0.0 --group-id -1
+ wq_config_test
+ local read_ret
+ ../accfg/accel-config config-wq dsa0/wq0.0 -m shared
++ cat /sys/bus/dsa/devices/dsa0/wq0.0/mode
+ read_ret=shared
+ '[' shared '!=' shared ']'
+ ../accfg/accel-config config-wq dsa0/wq0.0 --mode dedicated
++ cat /sys/bus/dsa/devices/dsa0/wq0.0/mode
+ read_ret=dedicated
+ '[' dedicated '!=' dedicated ']'
+ ../accfg/accel-config config-wq dsa0/wq0.0 -s 128
++ cat /sys/bus/dsa/devices/dsa0/wq0.0/size
+ read_ret=128
+ '[' 128 -ne 128 ']'
+ ../accfg/accel-config config-wq dsa0/wq0.0 --wq-size 16
+ ../accfg/accel-config config-wq dsa0/wq0.0 -g 3
++ cat /sys/bus/dsa/devices/dsa0/wq0.0/group_id
+ read_ret=3
+ '[' 3 -ne 3 ']'
+ ../accfg/accel-config config-wq dsa0/wq0.0 -g -1
+ '[' 0x100 '!=' 0x100 ']'
+ _cleanup
+ lsmod
+ grep -wq idxd_vdev
+ lsmod
+ grep -wq idxd_uacce
+ lsmod
+ grep -wq iaa_crypto
+ lsmod
+ grep -wq iax_crypto
+ lsmod
+ grep -wq idxd
+ rmmod idxd
+ lsmod
+ grep -wq vfio_pci
+ sleep 1
+ modprobe idxd
+ sleep 1
+ modprobe vfio_pci
+ exit 0
PASS dsa_config_test_runner.sh (exit status: 0)
